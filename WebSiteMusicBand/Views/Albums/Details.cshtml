@model WebSiteMusicBand.Model.Album

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int albID = Model.AlbumId;
    Dictionary<int, int> positionKey_idValue = new Dictionary<int, int>();
}

<h2>Details</h2>

<div>
    <h4>Album</h4>
    <hr />

    <table width="100%" cellspacing="0" cellpadding="0">
        <tr>
            <td class="leftcol" height="auto">
                <img  class="img-responsive user-photo myImg" src=@Url.Content(Model.CoverLink)
                     width="100%"  alt=@Model.Title>
            </td>
            <td valign="top">
                <dl class="dl-horizontal">
                    <dt>
                        @Html.DisplayNameFor(model => model.Title)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.Title)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.Year)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.Year)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.NumOfTracks)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.NumOfTracks)
                    </dd>



                </dl>
            </td>
        </tr>
    </table>
    <br/>
    </div>

    @if (SecureCustomHelper.IsCurrenAdmin())
    {
        <div class="btn btn-default myRight">
            @Html.ActionLink("Edit", "Edit", new { id = Model.AlbumId })
        </div>
        <div class="btn btn-default myRight">
            @Html.ActionLink("Delete", "Delete", new { id = Model.AlbumId })
        </div>
    }


    <div class="btn btn-default" style="float:left">
        @Html.ActionLink("Back", "Details", new { id = albID })
    </div>
<br/>

<table id="jsGrid"></table>



<div>

@Html.Partial("~/Views/Albums/MusicPlayerBar.cshtml", Model)
</div>

@section Styles{
    @Styles.Render("~/bundles/jsgrid/css")

   TD.leftcol {
    width: 20%; /* Ширина левой колонки с рисунком */
    vertical-align: top; /* Выравнивание по верхнему краю */
   }
    #cover{
    height: auto;
    }
}

@section Scripts{
    @Scripts.Render("~/bundles/jsgrid/js")

    <script type="text/javascript">
        var alb = @albID;
        $("#jsGrid").jsGrid({

            height: "auto",
            width: "100%",

            autoload: true,


            controller: {
                loadData: function (filter) {
                    return $.ajax({
                        type: "GET",
                        url: "/api/tracks",
                        data: 'albumId=' + alb,
                        dataType: "json"
                    });
                },

                insertItem: function (item) {
                    return $.ajax({
                        type: "POST",
                        url: "/api/Tracks/" + alb,
                        data: item,
                        dataType: "json"
                    });
                },

                updateItem: function (item) {
                    return $.ajax({
                        type: "PUT",
                        url: "/api/Tracks/",
                        data: item,
                        dataType: "json"
                    });
                },

                deleteItem: function (item) {
                    return $.ajax({
                        type: "DELETE",
                        url: "/api/Tracks/" + item.TrackId,
                        dataType: "json"
                    });
                }
            },

            fields: [
                { name: "Position", type: "number", width: 35, title: "№" },
                { name: "NameOfTrack", type: "text", width: 150, title: "Title" },
                { name: "Duration", type: "text", width: 100 },                     
                {
                    itemTemplate: function (_, item) 
                    {
                        if(item.DoesTrackFileExists)
                        {
                            return $("<button>").text("Play")
                                .on("click", function () 
                                {
                                    soundManager.stopAll();
                                    window.sm2BarPlayers[0].actions.play(item.GridPosition);
                                });
                        }
                        else
                        {
                            return $("<div>").text("track not found");
                        }
                    }
                },
            ]
        });
        $("#jsGrid").jsGrid("fieldOption", "NameOfTrack", "align", "center");

    </script>
}

